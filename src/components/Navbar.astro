---
import { name } from "spectre:globals";

const path = Astro.url.pathname.replace(/\/$/, '') || '/';

const navItems = [
  { label: "Engineering", href: "/engineering" },
  { label: "Advocacy", href: "/advocacy" },
  { label: "Media", href: "/media" },
  { label: "Blog", href: "https://sub.zacbowling.com/", external: true },
  { label: "Projects", href: "https://zbowling.github.io", external: true },
];
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="site-header">
  <nav class="container-narrow flex items-center justify-between h-16 md:h-20">
    <!-- Logo -->
    <a
      href="/"
      class="font-display text-xl md:text-2xl text-text no-underline hover:text-forest transition-colors tracking-tight"
    >
      {name}
    </a>

    <!-- Desktop Nav -->
    <ul class="hidden md:flex items-center gap-1 list-none m-0 p-0">
      {navItems.map((item) => (
        <li>
          <a
            href={item.href}
            class:list={[
              "inline-block px-3 py-1.5 text-sm font-medium tracking-wide no-underline transition-colors duration-200",
              path === item.href
                ? "text-forest"
                : "text-text-secondary hover:text-text",
            ]}
            target={item.external ? "_blank" : undefined}
            rel={item.external ? "noopener noreferrer" : undefined}
          >
            {item.label}
            {item.external && (
              <span class="inline-block ml-0.5 text-text-muted text-xs">&#8599;</span>
            )}
          </a>
        </li>
      ))}
    </ul>

    <!-- Mobile Toggle -->
    <button
      class="md:hidden flex items-center justify-center w-10 h-10 text-text"
      id="mobile-toggle"
      aria-label="Toggle navigation"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <svg class="menu-open-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="4" y1="7" x2="20" y2="7" />
        <line x1="4" y1="12" x2="20" y2="12" />
        <line x1="4" y1="17" x2="20" y2="17" />
      </svg>
      <svg class="menu-close-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="6" y1="6" x2="18" y2="18" />
        <line x1="6" y1="18" x2="18" y2="6" />
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div class="md:hidden overflow-hidden transition-all duration-500 ease-out max-h-0 opacity-0 bg-ivory" id="mobile-menu" aria-hidden="true">
    <div class="container-narrow pb-8 pt-2">
      <ul class="list-none m-0 p-0 flex flex-col gap-0">
        {navItems.map((item, i) => (
          <li class="border-b border-border">
            <a
              href={item.href}
              class:list={[
                "block py-4 text-lg no-underline transition-colors",
                path === item.href
                  ? "text-forest font-medium"
                  : "text-text-secondary hover:text-text",
              ]}
              target={item.external ? "_blank" : undefined}
              rel={item.external ? "noopener noreferrer" : undefined}
            >
              {item.label}
              {item.external && (
                <span class="inline-block ml-1 text-text-muted text-sm">&#8599;</span>
              )}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16 md:h-20"></div>

<script is:inline>
  // Header background on scroll
  const header = document.getElementById('site-header');
  const handleScroll = () => {
    if (window.scrollY > 20) {
      header.classList.add('bg-ivory/95', 'backdrop-blur-md', 'border-b', 'border-border');
    } else {
      header.classList.remove('bg-ivory/95', 'backdrop-blur-md', 'border-b', 'border-border');
    }
  };
  window.addEventListener('scroll', handleScroll, { passive: true });
  handleScroll();

  // Mobile menu toggle
  const toggle = document.getElementById('mobile-toggle');
  const menu = document.getElementById('mobile-menu');
  const openIcon = toggle.querySelector('.menu-open-icon');
  const closeIcon = toggle.querySelector('.menu-close-icon');

  toggle.addEventListener('click', () => {
    const isOpen = menu.classList.contains('max-h-screen');
    if (isOpen) {
      menu.classList.remove('max-h-screen', 'opacity-100');
      menu.classList.add('max-h-0', 'opacity-0');
      openIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
      header.classList.remove('bg-ivory', 'border-b', 'border-border');
      handleScroll();
      toggle.setAttribute('aria-expanded', 'false');
      menu.setAttribute('aria-hidden', 'true');
    } else {
      menu.classList.remove('max-h-0', 'opacity-0');
      menu.classList.add('max-h-screen', 'opacity-100');
      openIcon.classList.add('hidden');
      closeIcon.classList.remove('hidden');
      header.classList.add('bg-ivory', 'border-b', 'border-border');
      toggle.setAttribute('aria-expanded', 'true');
      menu.setAttribute('aria-hidden', 'false');
    }
  });
</script>
